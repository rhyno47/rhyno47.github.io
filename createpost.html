<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/ads.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1523965413574724"
     crossorigin="anonymous"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Job Post</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <script src="/assets/env.js"></script>
  <style>
    body { background: #f8f9fa; }
    .container { max-width: 720px; margin-top: 40px; }
    .auth-form { background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
  </style>
</head>
<body>
  <div class="container">
    <div class="auth-form">
      <h2>Create Job Post</h2>
      <form id="jobForm">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input class="form-control" name="title" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Company</label>
          <input class="form-control" name="company" />
        </div>
        <div class="mb-3">
          <label class="form-label">Location</label>
          <input class="form-control" name="location" />
        </div>
        <div class="mb-3">
          <label class="form-label">Contact (email or phone)</label>
          <input class="form-control" name="contact" />
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea class="form-control" name="description" rows="5"></textarea>
        </div>
        <div id="msg" class="mb-3"></div>
        <button class="btn btn-primary">Publish</button>
        <a href="/findjobs.html" class="btn btn-secondary ms-2">Back</a>
      </form>
    </div>
  </div>

<script>
// Helper to show a consistent styled message
function showMessage(type, html){
  const msg = document.getElementById('msg');
  if(!msg) return;
  const icon = type === 'success' ? 'check-circle-fill' : (type === 'warning' ? 'exclamation-triangle-fill' : 'x-circle-fill');
  msg.innerHTML = `
    <div class="alert alert-${type} d-flex align-items-start gap-2 py-2 px-3 fade show" role="alert" style="animation:fadeIn .25s ease">
      <i class="bi bi-${icon}" aria-hidden="true"></i>
      <div class="flex-grow-1 small">${html}</div>
    </div>`;
}

document.getElementById('jobForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const data = {
    title: form.title.value.trim(),
    company: form.company.value.trim(),
    location: form.location.value.trim(),
    contact: form.contact.value.trim(),
    description: form.description.value.trim()
  };
  showMessage('info', 'Posting job…');

  const token = localStorage.getItem('token');
  if (!token) {
    showMessage('danger', 'You must be logged in to post a job. <a href="/public/login.html" class="alert-link">Login</a>');
    return;
  }

  try {
    const base = (window.API_BASE || '').replace(/\/$/, '');
    const url = base ? (base + '/api/jobs') : '/api/jobs';
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json', 'Authorization': 'Bearer ' + token },
      body: JSON.stringify(data)
    });
    let json = {};
    try { json = await res.json(); } catch(_){}
    if (!res.ok) {
      showMessage('danger', json.message || (json.errors && json.errors[0]?.msg) || 'Failed to create post');
      return;
    }
    showMessage('success', 'Job posted successfully. Redirecting…');
    setTimeout(()=> window.location.href = '/findjobs.html', 1200);
  } catch (err) {
    showMessage('danger', 'Network error. Please try again.');
  }
});
</script>
<style>
@keyframes fadeIn { from { opacity:0; transform:translateY(-4px);} to { opacity:1; transform:translateY(0);} }
#msg .alert { border:1px solid rgba(0,0,0,0.06); box-shadow:0 2px 6px rgba(0,0,0,0.04); }
#msg .alert-success { border-color: rgba(25,135,84,.25); }
#msg .alert-danger { border-color: rgba(220,53,69,.3); }
#msg .alert-info { border-color: rgba(13,202,240,.3); }
</style>

<!-- Non-intrusive display ad -->
<div class="ad-slot ad-center ad-between">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-1523965413574724"
       data-ad-slot="2315208152"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
</div>

  <script defer src="/assets/ads.js"></script>
</body>
</html>
